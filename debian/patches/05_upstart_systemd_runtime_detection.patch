Description: Detect if upstart or systemd are running, not if their corresponding configfiles are installed
 Also change the systemctl path to fit Debian's
Author: Didier Raboud <odyx@debian.org>
Origin: vendor
Bug-Debian: https://bugs.debian.org/725394
Last-Update: 2016-06-13

--- a/usb_modeswitch.sh
+++ b/usb_modeswitch.sh
@@ -60,9 +60,9 @@
 
 PATH=/bin:/sbin:/usr/bin:/usr/sbin
 init_path=`readlink /sbin/init`
-if [ `basename $init_path` = "systemd" ]; then
+if [ `basename $init_path` = "systemd" ] && [ -d "/run/systemd/system/" ]; then # Test if systemd is running
 	systemctl --no-block start usb_modeswitch@$p1'_'$p2.service
-elif [ -e "/etc/init/usb-modeswitch-upstart.conf" ]; then
+elif [ -e "/etc/init/usb-modeswitch-upstart.conf" ] && [ -x /sbin/initctl ] && /sbin/initctl version 2>/dev/null | /bin/grep -q upstart; then # Test if upstart is running
 	initctl emit --no-wait usb-modeswitch-upstart UMS_PARAM=$1
 else
 	# only old distros, new udev will kill all subprocesses
